# $Id$
# $URL$
# $Rev$
# $Author$
# $Date$

export MONO_PATH=../lib:+$$MONO_PATH

CSC=gmcs
#AOT=mono --aot -O=all
AOT=true
COPY=cp
MKDIR=mkdir
FIND=find

PREFIX=/usr/local
DESTDIR=
INSTALL_DIR=$(DESTDIR)$(PREFIX)/lib/smuxi
INSTALL_BIN_DIR=$(DESTDIR)$(PREFIX)/bin
INSTALL_APPLICATIONS_DIR=$(DESTDIR)$(PREFIX)/share/applications

SMARTIRC_DLL=Meebey.SmartIrc4net.dll
SMARTIRC_DIR=../lib
SMARTIRC_REF=-r:$(SMARTIRC_DIR)/$(SMARTIRC_DLL)

JABBER_DLL=jabber-net.dll
JABBER_DIR=../lib
JABBER_REF=-r:$(JABBER_DIR)/$(JABBER_DLL)

LOG4NET_DLL=log4net.dll
LOG4NET_DIR=../lib
LOG4NET_REF=-r:$(LOG4NET_DIR)/$(LOG4NET_DLL) 

NINI_DLL=Nini.dll
NINI_DIR=../lib
NINI_REF=-r:$(NINI_DIR)/$(NINI_DLL)

POSIX_DLL=Mono.Posix.dll
POSIX_DIR=../lib
POSIX_REF=-r:$(POSIX_DIR)/$(POSIX_DLL)

COMMON_DEFINES=NET_2_0
ENGINE_DEFINES=CONFIG_NINI
GNOME_DEFINES=UI_GNOME,GTK_SHARP_2,CONFIG_NINI
GTK_DEFINES=UI_GTK,GTK_SHARP_2,CONFIG_NINI

SERVER_REFS=-r:System.Runtime.Remoting
ENGINE_REFS=$(NINI_REF) $(POSIX_REF)
FRONTEND_REFS=$(POSIX_REF) -r:System -r:System.Runtime.Remoting
TEST_REFS=-r:System.Runtime.Remoting
GTK_REFS=$(NINI_REF) $(POSIX_REF) -r:System.Runtime.Remoting -r:System.Drawing
GNOME_REFS=$(NINI_REF) $(POSIX_REF) -r:System.Runtime.Remoting -r:System.Drawing

GTK_PACKAGES=gtk-sharp-2.0,glade-sharp-2.0
GNOME_PACKAGES=gnome-sharp-2.0,gtk-sharp-2.0,glade-sharp-2.0

RESOURCES = \
../images/splashscreen.png \
../images/about.png \
../images/connect.png \
../images/edit.png \
../glade/smuxi-frontend-gnome.glade

RESOURCES_BUILD = $(foreach res,$(RESOURCES), $(addprefix -resource:,$(res)),$(notdir $(res)))

BIN_DIR=../bin
DEBUG_DIR=$(BIN_DIR)/debug
RELEASE_DIR=$(BIN_DIR)/release

COMMON_SOURCE=$(shell $(FIND) Common/ -name "*.cs")
COMMON_TARGET=smuxi-common.dll
COMMON_DEBUG_TARGET=$(DEBUG_DIR)/$(COMMON_TARGET)
COMMON_RELEASE_TARGET=$(RELEASE_DIR)/$(COMMON_TARGET)

ENGINE_SOURCE=$(shell $(FIND) Engine/ -name "*.cs")
ENGINE_TARGET=smuxi-engine.dll
ENGINE_DEBUG_TARGET=$(DEBUG_DIR)/$(ENGINE_TARGET)
ENGINE_RELEASE_TARGET=$(RELEASE_DIR)/$(ENGINE_TARGET)

ENGINE_IRC_REFS=$(SMARTIRC_REF) $(POSIX_REF)
ENGINE_IRC_SOURCE=$(shell $(FIND) Engine-IRC/ -name "*.cs")
ENGINE_IRC_TARGET=smuxi-engine-irc.dll
ENGINE_IRC_DEBUG_TARGET=$(DEBUG_DIR)/$(ENGINE_IRC_TARGET)
ENGINE_IRC_RELEASE_TARGET=$(RELEASE_DIR)/$(ENGINE_IRC_TARGET)

ENGINE_XMPP_REFS=$(JABBER_REF) $(POSIX_REF)
ENGINE_XMPP_SOURCE=$(shell $(FIND) Engine-XMPP/ -name "*.cs")
ENGINE_XMPP_TARGET=smuxi-engine-xmpp.dll
ENGINE_XMPP_DEBUG_TARGET=$(DEBUG_DIR)/$(ENGINE_XMPP_TARGET)
ENGINE_XMPP_RELEASE_TARGET=$(RELEASE_DIR)/$(ENGINE_XMPP_TARGET)

SERVER_SOURCE=$(shell $(FIND) Server/ -name "*.cs")
SERVER_TARGET=smuxi-server.exe
SERVER_DEBUG_TARGET=$(DEBUG_DIR)/$(SERVER_TARGET)
SERVER_RELEASE_TARGET=$(RELEASE_DIR)/$(SERVER_TARGET)

FRONTEND_SOURCE=$(shell $(FIND) Frontend/ -name "*.cs")
FRONTEND_TARGET=smuxi-frontend.dll
FRONTEND_DEBUG_TARGET=$(DEBUG_DIR)/$(FRONTEND_TARGET)
FRONTEND_RELEASE_TARGET=$(RELEASE_DIR)/$(FRONTEND_TARGET)

TEST_SOURCE=$(shell $(FIND) Frontend-Test/ -name "*.cs")
TEST_TARGET=smuxi-test.exe
TEST_DEBUG_TARGET=$(DEBUG_DIR)/$(TEST_TARGET)
TEST_RELEASE_TARGET=$(RELEASE_DIR)/$(TEST_TARGET)

GTK_SOURCE=$(shell $(FIND) Frontend-GNOME/ -name "*.cs")
GTK_TARGET=smuxi-frontend-gtk.exe
GTK_DEBUG_TARGET=$(DEBUG_DIR)/$(GTK_TARGET)
GTK_RELEASE_TARGET=$(RELEASE_DIR)/$(GTK_TARGET)

GTK_IRC_SOURCE=$(GNOME_IRC_SOURCE)
GTK_IRC_TARGET=smuxi-frontend-gtk-irc.dll
GTK_IRC_DEBUG_TARGET=$(DEBUG_DIR)/$(GTK_IRC_TARGET)
GTK_IRC_RELEASE_TARGET=$(RELEASE_DIR)/$(GTK_IRC_TARGET)

GTK_XMPP_SOURCE=$(GNOME_XMPP_SOURCE)
GTK_XMPP_TARGET=smuxi-frontend-gtk-xmpp.dll
GTK_XMPP_DEBUG_TARGET=$(DEBUG_DIR)/$(GTK_XMPP_TARGET)
GTK_XMPP_RELEASE_TARGET=$(RELEASE_DIR)/$(GTK_XMPP_TARGET)

GNOME_SOURCE=$(shell $(FIND) Frontend-GNOME/ -name "*.cs")
GNOME_TARGET=smuxi-frontend-gnome.exe
GNOME_DEBUG_TARGET=$(DEBUG_DIR)/$(GNOME_TARGET)
GNOME_RELEASE_TARGET=$(RELEASE_DIR)/$(GNOME_TARGET)

GNOME_IRC_SOURCE=$(shell $(FIND) Frontend-GNOME-IRC/ -name "*.cs")
GNOME_IRC_TARGET=smuxi-frontend-gnome-irc.dll
GNOME_IRC_DEBUG_TARGET=$(DEBUG_DIR)/$(GNOME_IRC_TARGET)
GNOME_IRC_RELEASE_TARGET=$(RELEASE_DIR)/$(GNOME_IRC_TARGET)

GNOME_XMPP_SOURCE=$(shell $(FIND) Frontend-GNOME-XMPP/ -name "*.cs")
GNOME_XMPP_TARGET=smuxi-frontend-gnome-xmpp.dll
GNOME_XMPP_DEBUG_TARGET=$(DEBUG_DIR)/$(GNOME_XMPP_TARGET)
GNOME_XMPP_RELEASE_TARGET=$(RELEASE_DIR)/$(GNOME_XMPP_TARGET)

default: all

all: debug-all release-all

debug-all: \
	$(COMMON_DEBUG_TARGET) \
	$(ENGINE_DEBUG_TARGET) \
	$(ENGINE_IRC_DEBUG_TARGET) \
	$(ENGINE_XMPP_DEBUG_TARGET) \
	$(SERVER_DEBUG_TARGET) \
	$(FRONTEND_DEBUG_TARGET) \
	$(TEST_DEBUG_TARGET) \
	$(GTK_DEBUG_TARGET) \
	$(GTK_IRC_DEBUG_TARGET) \
	$(GTK_XMPP_DEBUG_TARGET) \
	$(GNOME_DEBUG_TARGET) \
	$(GNOME_IRC_DEBUG_TARGET) \
	$(GNOME_XMPP_DEBUG_TARGET) \

release-all: \
	$(COMMON_RELEASE_TARGET) \
	$(ENGINE_RELEASE_TARGET) \
	$(ENGINE_IRC_RELEASE_TARGET) \
	$(ENGINE_XMPP_RELEASE_TARGET) \
	$(SERVER_RELEASE_TARGET) \
	$(FRONTEND_RELEASE_TARGET) \
	$(GTK_RELEASE_TARGET) \
	$(GTK_IRC_RELEASE_TARGET) \
	$(GTK_XMPP_RELEASE_TARGET) \
	$(GNOME_RELEASE_TARGET) \
	$(GNOME_IRC_RELEASE_TARGET) \
	$(GNOME_XMPP_RELEASE_TARGET) \


$(COMMON_DEBUG_TARGET): $(COMMON_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -define:$(COMMON_DEFINES) -target:library $(LOG4NET_REF) -out:$(COMMON_DEBUG_TARGET) $^
	$(AOT) $(COMMON_DEBUG_TARGET)

$(COMMON_RELEASE_TARGET): $(COMMON_SOURCE)
	$(CSC) -target:library -define:$(COMMON_DEFINES) -out:$(COMMON_RELEASE_TARGET) $^
	$(AOT) $(COMMON_RELEASE_TARGET)


$(ENGINE_DEBUG_TARGET): $(COMMON_DEBUG_TARGET)
$(ENGINE_DEBUG_TARGET): $(ENGINE_SOURCE)
	$(CSC) -debug -define:$(ENGINE_DEFINES),TRACE,LOG4NET -target:library $(ENGINE_REFS) -r:$(COMMON_DEBUG_TARGET)  $(LOG4NET_REF) -out:$(ENGINE_DEBUG_TARGET) $(ENGINE_SOURCE)
	$(AOT) $(ENGINE_DEBUG_TARGET)

$(ENGINE_RELEASE_TARGET): $(COMMON_RELEASE_TARGET)
$(ENGINE_RELEASE_TARGET): $(ENGINE_SOURCE)
	$(CSC) -define:$(ENGINE_DEFINES) -target:library $(ENGINE_REFS) -r:$(COMMON_RELEASE_TARGET) -out:$(ENGINE_RELEASE_TARGET) $(ENGINE_SOURCE)
	$(AOT) $(ENGINE_RELEASE_TARGET)


$(ENGINE_IRC_DEBUG_TARGET): $(ENGINE_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(ENGINE_IRC_DEBUG_TARGET): $(ENGINE_IRC_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -target:library $(ENGINE_IRC_REFS) -r:$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET) $(LOG4NET_REF) -out:$(ENGINE_IRC_DEBUG_TARGET) $(ENGINE_IRC_SOURCE)
	$(AOT) $(ENGINE_IRC_DEBUG_TARGET)

$(ENGINE_IRC_RELEASE_TARGET): $(ENGINE_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(ENGINE_IRC_RELEASE_TARGET): $(ENGINE_IRC_SOURCE)
	$(CSC) -target:library $(ENGINE_IRC_REFS) -r:$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET) -out:$(ENGINE_IRC_RELEASE_TARGET) $(ENGINE_IRC_SOURCE)
	$(AOT) $(ENGINE_IRC_RELEASE_TARGET)


$(ENGINE_XMPP_DEBUG_TARGET): $(ENGINE_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(ENGINE_XMPP_DEBUG_TARGET): $(ENGINE_XMPP_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -target:library $(ENGINE_XMPP_REFS) -r:$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET) $(LOG4NET_REF) -out:$(ENGINE_XMPP_DEBUG_TARGET) $(ENGINE_XMPP_SOURCE)
	$(AOT) $(ENGINE_XMPP_DEBUG_TARGET)

$(ENGINE_XMPP_RELEASE_TARGET): $(ENGINE_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(ENGINE_XMPP_RELEASE_TARGET): $(ENGINE_XMPP_SOURCE)
	$(CSC) -target:library $(ENGINE_XMPP_REFS) -r:$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET) -out:$(ENGINE_XMPP_RELEASE_TARGET) $(ENGINE_XMPP_SOURCE)
	$(AOT) $(ENGINE_XMPP_RELEASE_TARGET)


$(SERVER_DEBUG_TARGET): $(ENGINE_DEBUG_TARGET)
$(SERVER_DEBUG_TARGET): $(SERVER_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -target:exe $(SERVER_REFS) -r:$(ENGINE_DEBUG_TARGET) $(LOG4NET_REF) -out:$(SERVER_DEBUG_TARGET) $(SERVER_SOURCE)
	$(AOT) $(SERVER_DEBUG_TARGET)

$(SERVER_RELEASE_TARGET): $(ENGINE_RELEASE_TARGET)
$(SERVER_RELEASE_TARGET): $(SERVER_SOURCE)
	$(CSC) -target:exe $(SERVER_REFS) -r:$(ENGINE_RELEASE_TARGET) -out:$(SERVER_RELEASE_TARGET) $(SERVER_SOURCE)
	$(AOT) $(SERVER_RELEASE_TARGET)


$(FRONTEND_DEBUG_TARGET): $(ENGINE_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(FRONTEND_DEBUG_TARGET): $(FRONTEND_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -target:library $(FRONTEND_REFS),$(COMMON_DEBUG_TARGET) -r:$(ENGINE_DEBUG_TARGET) $(LOG4NET_REF) -out:$(FRONTEND_DEBUG_TARGET)  $(FRONTEND_SOURCE)

$(FRONTEND_RELEASE_TARGET): $(ENGINE_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(FRONTEND_RELEASE_TARGET): $(FRONTEND_SOURCE)
	$(CSC) -target:library $(FRONTEND_REFS) -r:$(ENGINE_RELEASE_TARGET),$(COMMON_RELEASE_TARGET) -out:$(FRONTEND_RELEASE_TARGET)  $(FRONTEND_SOURCE)


$(TEST_DEBUG_TARGET): $(TEST_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -target:exe $(TEST_REFS) -r:$(COMMON_DEBUG_TARGET) -r:$(ENGINE_DEBUG_TARGET) $(LOG4NET_REF) -out:$(TEST_DEBUG_TARGET) $^
	$(AOT) $(TEST_DEBUG_TARGET)


$(GTK_DEBUG_TARGET): $(FRONTEND_DEBUG_TARGET) $(ENGINE_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(GTK_DEBUG_TARGET): $(GTK_SOURCE)
	$(CSC) -debug -define:$(GTK_DEFINES),TRACE,LOG4NET -nowarn:0169 -target:exe $(GTK_REFS) -r:$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET),$(FRONTEND_DEBUG_TARGET) $(LOG4NET_REF) -pkg:$(GTK_PACKAGES) $(RESOURCES_BUILD) -out:$(GTK_DEBUG_TARGET) $(GTK_SOURCE)
	$(AOT) $(GTK_DEBUG_TARGET)

$(GTK_RELEASE_TARGET): $(FRONTEND_RELEASE_TARGET) $(ENGINE_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(GTK_RELEASE_TARGET): $(GTK_SOURCE)
	$(CSC) -define:$(GTK_DEFINES) -nowarn:0169 -target:exe $(GTK_REFS) -r:$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET),$(FRONTEND_RELEASE_TARGET) -pkg:$(GTK_PACKAGES) $(RESOURCES_BUILD) -out:$(GTK_RELEASE_TARGET) $(GTK_SOURCE)
	$(AOT) $(GTK_RELEASE_TARGET)


$(GTK_IRC_DEBUG_TARGET): $(GTK_DEBUG_TARGET) $(FRONTEND_DEBUG_TARGET) $(ENGINE_DEBUG_TARGET) $(ENGINE_IRC_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(GTK_IRC_DEBUG_TARGET): $(GTK_IRC_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -nowarn:0169 -target:library $(GTK_REFS) -r:$(GTK_DEBUG_TARGET),$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET),$(ENGINE_IRC_DEBUG_TARGET),$(FRONTEND_DEBUG_TARGET) $(LOG4NET_REF) -pkg:$(GTK_PACKAGES) $(RESOURCES_BUILD) -out:$(GTK_IRC_DEBUG_TARGET) $(GTK_IRC_SOURCE)
	$(AOT) $(GTK_IRC_DEBUG_TARGET)

$(GTK_IRC_RELEASE_TARGET): $(GTK_RELEASE_TARGET) $(FRONTEND_RELEASE_TARGET) $(ENGINE_RELEASE_TARGET) $(ENGINE_IRC_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(GTK_IRC_RELEASE_TARGET): $(GTK_IRC_SOURCE)
	$(CSC) -nowarn:0169 -target:library $(GTK_REFS) -r:$(GTK_RELEASE_TARGET),$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET),$(ENGINE_IRC_RELEASE_TARGET),$(FRONTEND_RELEASE_TARGET) -pkg:$(GTK_PACKAGES) $(RESOURCES_BUILD) -out:$(GTK_IRC_RELEASE_TARGET) $(GTK_IRC_SOURCE)
	$(AOT) $(GTK_IRC_RELEASE_TARGET)


$(GTK_XMPP_DEBUG_TARGET): $(GTK_DEBUG_TARGET) $(FRONTEND_DEBUG_TARGET) $(ENGINE_DEBUG_TARGET) $(ENGINE_XMPP_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(GTK_XMPP_DEBUG_TARGET): $(GTK_XMPP_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -nowarn:0169 -target:library $(GTK_REFS) -r:$(GTK_DEBUG_TARGET),$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET),$(ENGINE_XMPP_DEBUG_TARGET),$(FRONTEND_DEBUG_TARGET) $(LOG4NET_REF) -pkg:$(GTK_PACKAGES) $(RESOURCES_BUILD) -out:$(GTK_XMPP_DEBUG_TARGET) $(GTK_XMPP_SOURCE)
	$(AOT) $(GTK_XMPP_DEBUG_TARGET)

$(GTK_XMPP_RELEASE_TARGET): $(GTK_RELEASE_TARGET) $(FRONTEND_RELEASE_TARGET) $(ENGINE_RELEASE_TARGET) $(ENGINE_XMPP_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(GTK_XMPP_RELEASE_TARGET): $(GTK_XMPP_SOURCE)
	$(CSC) -nowarn:0169 -target:library $(GTK_REFS) -r:$(GTK_RELEASE_TARGET),$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET),$(ENGINE_XMPP_RELEASE_TARGET),$(FRONTEND_RELEASE_TARGET) -pkg:$(GTK_PACKAGES) $(RESOURCES_BUILD) -out:$(GTK_IRC_RELEASE_TARGET) $(GTK_XMPP_SOURCE)
	$(AOT) $(GTK_XMPP_RELEASE_TARGET)


$(GNOME_DEBUG_TARGET): $(GTK_SOURCE)
	$(CSC) -debug -define:$(GNOME_DEFINES),TRACE,LOG4NET -nowarn:0169 -target:exe $(GNOME_REFS) -r:$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET),$(FRONTEND_DEBUG_TARGET) $(LOG4NET_REF) -pkg:$(GNOME_PACKAGES) $(RESOURCES_BUILD) -out:$(GNOME_DEBUG_TARGET) $^
	$(AOT) $(GNOME_DEBUG_TARGET)

$(GNOME_RELEASE_TARGET): $(GTK_SOURCE)
	$(CSC) -define:$(GNOME_DEFINES) -nowarn:0169 -target:exe $(GNOME_REFS) -r:$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET),$(FRONTEND_RELEASE_TARGET) -pkg:$(GNOME_PACKAGES) $(RESOURCES_BUILD) -out:$(GNOME_RELEASE_TARGET) $^
	$(AOT) $(GNOME_RELEASE_TARGET)


$(GNOME_IRC_DEBUG_TARGET): $(GNOME_DEBUG_TARGET) $(FRONTEND_DEBUG_TARGET) $(ENGINE_DEBUG_TARGET) $(ENGINE_IRC_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(GNOME_IRC_DEBUG_TARGET): $(GNOME_IRC_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -nowarn:0169 -target:library $(GNOME_REFS) -r:$(GNOME_DEBUG_TARGET),$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET),$(ENGINE_IRC_DEBUG_TARGET),$(FRONTEND_DEBUG_TARGET) $(LOG4NET_REF) -pkg:$(GNOME_PACKAGES) $(RESOURCES_BUILD) -out:$(GNOME_IRC_DEBUG_TARGET) $(GNOME_IRC_SOURCE)
	$(AOT) $(GNOME_IRC_DEBUG_TARGET)

$(GNOME_IRC_RELEASE_TARGET): $(GNOME_RELEASE_TARGET) $(FRONTEND_RELEASE_TARGET) $(ENGINE_RELEASE_TARGET) $(ENGINE_IRC_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(GNOME_IRC_RELEASE_TARGET): $(GNOME_IRC_SOURCE)
	$(CSC) -nowarn:0169 -target:library $(GNOME_REFS) -r:$(GNOME_RELEASE_TARGET),$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET),$(ENGINE_IRC_RELEASE_TARGET),$(FRONTEND_RELEASE_TARGET) -pkg:$(GNOME_PACKAGES) $(RESOURCES_BUILD) -out:$(GNOME_IRC_RELEASE_TARGET) $(GNOME_IRC_SOURCE)
	$(AOT) $(GNOME_IRC_RELEASE_TARGET)


$(GNOME_XMPP_DEBUG_TARGET): $(GNOME_DEBUG_TARGET) $(FRONTEND_DEBUG_TARGET) $(ENGINE_DEBUG_TARGET) $(ENGINE_XMPP_DEBUG_TARGET) $(COMMON_DEBUG_TARGET)
$(GNOME_XMPP_DEBUG_TARGET): $(GNOME_XMPP_SOURCE)
	$(CSC) -debug -define:TRACE,LOG4NET -nowarn:0169 -target:library $(GNOME_REFS) -r:$(GNOME_DEBUG_TARGET),$(COMMON_DEBUG_TARGET),$(ENGINE_DEBUG_TARGET),$(ENGINE_XMPP_DEBUG_TARGET),$(FRONTEND_DEBUG_TARGET) $(LOG4NET_REF) -pkg:$(GNOME_PACKAGES) $(RESOURCES_BUILD) -out:$(GNOME_XMPP_DEBUG_TARGET) $(GNOME_XMPP_SOURCE)
	$(AOT) $(GNOME_XMPP_DEBUG_TARGET)

$(GNOME_XMPP_RELEASE_TARGET): $(GNOME_RELEASE_TARGET) $(FRONTEND_RELEASE_TARGET) $(ENGINE_RELEASE_TARGET) $(ENGINE_XMPP_RELEASE_TARGET) $(COMMON_RELEASE_TARGET)
$(GNOME_XMPP_RELEASE_TARGET): $(GNOME_XMPP_SOURCE)
	$(CSC) -nowarn:0169 -target:library $(GNOME_REFS) -r:$(GNOME_RELEASE_TARGET),$(COMMON_RELEASE_TARGET),$(ENGINE_RELEASE_TARGET),$(ENGINE_XMPP_RELEASE_TARGET),$(FRONTEND_RELEASE_TARGET) -pkg:$(GNOME_PACKAGES) $(RESOURCES_BUILD) -out:$(GNOME_XMPP_RELEASE_TARGET) $(GNOME_XMPP_SOURCE)
	$(AOT) $(GNOME_XMPP_RELEASE_TARGET)

install: install-debug-all

install-base:
	$(MKDIR) -p $(INSTALL_DIR)
	$(MKDIR) -p $(INSTALL_BIN_DIR)
	$(MKDIR) -p $(INSTALL_APPLICATIONS_DIR)
	$(COPY) ../smuxi-frontend-gnome $(INSTALL_BIN_DIR)
	$(COPY) ../smuxi-server $(INSTALL_BIN_DIR)
	$(COPY) ../smuxi.desktop $(INSTALL_APPLICATIONS_DIR)

install-debug-all: debug-all install-base
	$(COPY) $(COMMON_DEBUG_TARGET)*      $(INSTALL_DIR)
	$(COPY) $(ENGINE_DEBUG_TARGET)*      $(INSTALL_DIR)
	$(COPY) $(ENGINE_IRC_DEBUG_TARGET)*  $(INSTALL_DIR)
	$(COPY) $(ENGINE_XMPP_DEBUG_TARGET)* $(INSTALL_DIR)
	$(COPY) $(SERVER_DEBUG_TARGET)*      $(INSTALL_DIR)
	$(COPY) $(FRONTEND_DEBUG_TARGET)*    $(INSTALL_DIR)
	$(COPY) $(GTK_DEBUG_TARGET)*         $(INSTALL_DIR)
	$(COPY) $(GTK_IRC_DEBUG_TARGET)*     $(INSTALL_DIR)
	$(COPY) $(GTK_XMPP_DEBUG_TARGET)*    $(INSTALL_DIR)
	$(COPY) $(GNOME_DEBUG_TARGET)*       $(INSTALL_DIR)
	$(COPY) $(GNOME_IRC_DEBUG_TARGET)*   $(INSTALL_DIR)
	$(COPY) $(GNOME_XMPP_DEBUG_TARGET)*  $(INSTALL_DIR)

install-release-all: release-all install-base
	$(COPY) $(COMMON_RELEASE_TARGET)      $(INSTALL_DIR)
	$(COPY) $(ENGINE_RELEASE_TARGET)      $(INSTALL_DIR)
	$(COPY) $(ENGINE_IRC_RELEASE_TARGET)  $(INSTALL_DIR)
	$(COPY) $(ENGINE_XMPP_RELEASE_TARGET) $(INSTALL_DIR)
	$(COPY) $(SERVER_RELEASE_TARGET)      $(INSTALL_DIR)
	$(COPY) $(FRONTEND_RELEASE_TARGET)    $(INSTALL_DIR)
	$(COPY) $(GTK_RELEASE_TARGET)         $(INSTALL_DIR)
	$(COPY) $(GTK_IRC_RELEASE_TARGET)     $(INSTALL_DIR)
	$(COPY) $(GTK_XMPP_RELEASE_TARGET)    $(INSTALL_DIR)
	$(COPY) $(GNOME_RELEASE_TARGET)       $(INSTALL_DIR)
	$(COPY) $(GNOME_IRC_RELEASE_TARGET)   $(INSTALL_DIR)
	$(COPY) $(GNOME_XMPP_RELEASE_TARGET)  $(INSTALL_DIR)

clean:
	rm -f ../bin/debug/*.mdb
	rm -f ../bin/debug/*.exe.so
	rm -f ../bin/debug/*.dll.so
	rm -f $(COMMON_DEBUG_TARGET)
	rm -f $(ENGINE_DEBUG_TARGET)
	rm -f $(ENGINE_IRC_DEBUG_TARGET)
	rm -f $(ENGINE_XMPP_DEBUG_TARGET)
	rm -f $(SERVER_DEBUG_TARGET)
	rm -f $(FRONTEND_DEBUG_TARGET)
	rm -f $(TEST_DEBUG_TARGET)
	rm -f $(GTK_DEBUG_TARGET)
	rm -f $(GTK_IRC_DEBUG_TARGET)
	rm -f $(GTK_XMPP_DEBUG_TARGET)
	rm -f $(GNOME_DEBUG_TARGET)
	rm -f $(GNOME_IRC_DEBUG_TARGET)
	rm -f $(GNOME_XMPP_DEBUG_TARGET)
	rm -f ../bin/release/*.mdb
	rm -f ../bin/release/*.exe.so
	rm -f ../bin/release/*.dll.so
	rm -f $(COMMON_RELEASE_TARGET)
	rm -f $(ENGINE_RELEASE_TARGET)
	rm -f $(ENGINE_IRC_RELEASE_TARGET)
	rm -f $(ENGINE_XMPP_RELEASE_TARGET)
	rm -f $(SERVER_RELEASE_TARGET)
	rm -f $(FRONTEND_RELEASE_TARGET)
	rm -f $(TEST_RELEASE_TARGET)
	rm -f $(GTK_RELEASE_TARGET)
	rm -f $(GTK_IRC_RELEASE_TARGET)
	rm -f $(GTK_XMPP_RELEASE_TARGET)
	rm -f $(GNOME_RELEASE_TARGET)
	rm -f $(GNOME_IRC_RELEASE_TARGET)
	rm -f $(GNOME_XMPP_RELEASE_TARGET)

.PHONY: default all debug-all release-all install install-debug-all install-release-all clean
